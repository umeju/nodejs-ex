<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="../../favicon.ico">

        <title>La Casarana</title>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" 
              integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <link rel="stylesheet" href="http://www.di-vision.org/cdn/zetacode.css">
        
    </head>

    <body class="h86">
        <div id="bodiv"> </div>
        
        <script id="example-template" type="text/x-handlebars-template">
        <div  id="spinelli" class="row h86">
            {{#sites}}
                    {{#each this}}
                        <div class="news {{#if @first}}show{{else}} {{/if}}">

                                <div data-key="{{@key}}" class="main-image">
                                    <div class="chiave">
                                        <div class="id-foto">{{@key}}
                                            <div class="id-articolo">{{! @key}}</div>
                                        </div>
                                    </div>
                                    <img class="zeta" data-src="http://www.zetacode.it/upload/uploads/{{this}}" 
                                        src="http://www.zetacode.it/upload/uploads/{{this}}" />
                                </div>
                        </div>
                    {{/each}}
            {{/sites}}
        </div>
        </script>

        <div class='content-placeholder'></div>

        <span id="nextFoto" class="next"></span>
        <span id="prevFoto" class="prev"></span>

        <footer class="footer">
            <div class="container">
                <!--<p class="text-muted">-->
                <!--<iframe frameborder="0" scrolling="no" class="" src="http://www.di-vision.org/news/"></iframe>-->
                <!--</p>-->
            </div>
        </footer>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.js">
        </script>
        <!-- Bootstrap core JavaScript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js">
        </script>
        <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')
        </script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
                integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" 
        crossorigin="anonymous"></script>
        <script src="/socket.io/socket.io.js">
        </script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
                integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" 
        crossorigin="anonymous"></script>
        <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
        <!--<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>-->
        <script>
            var QueryString = function () {
                /* This function is anonymous, is executed immediately and 
                 the return value is assigned to QueryString!
                 */
                var query_string = {};
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                    // If first entry with this name
                    if (typeof query_string[pair[0]] === "undefined") {
                        query_string[pair[0]] = decodeURIComponent(pair[1]);
                        // If second entry with this name
                    } else if (typeof query_string[pair[0]] === "string") {
                        var arr = [query_string[pair[0]], decodeURIComponent(pair[1])];
                        query_string[pair[0]] = arr;
                        // If third or later entry with this name
                    } else {
                        query_string[pair[0]].push(decodeURIComponent(pair[1]));
                    }
                }
                return query_string;
            }();

            var userID = QueryString.ID;

            function jsonCallback(data) {
                console.log("console.log()");
                goCompile(data);
                /*        $.each(data.sites, function (key, val) {
                 //            console.log(data); get entire sites: <array>
                 //            if (val.titolo !== '') {
                 //                // avoid empty news
                 //            }
                 });*/
                return;
            }
            ;
            function getNews(urlJson) {
                $('<div></div>').attr('id', 'spinner')
                        .appendTo('body');
                $.ajax({
                    type: 'GET',
                    url: urlJson,
                    crossDomain: true,
                    jsonp: false,
                    cache: true,
                    jsonpCallback: 'jsonCallback',
                    dataType: 'jsonp',
                    success: function (json) {
                        console.log('success!');
                    },
                    error: function (e) {
                        console.log(e.message);
                    },
                    complete: function (jqXHR, textStatus) {
                        $("#spinner").remove();
                        slideShow();
                        slideShow2();
                    }
                });
            }
            ;

            function goCompile(returnData) {
        //            $.getJSON(returnedData, function (data){
                var theCompiledHtml = theTemplate(returnData);
                $('.content-placeholder').html(theCompiledHtml);
            }

            (function (exports) { //        var socket = io.connect(socketURI);
                var socket = io();
                socket.on('connection', function (data) {
                    console.log('socket connection on');
                });

                socket.on(userID + '-left', function (data) {
                    console.log(userID + ' left connect!');
                    $(".prev").trigger('click');
                });

                socket.on(userID + '-right', function (data) {
                    console.log(userID + ' right connect!');
                    $(".next").trigger('click');
                });

                socket.on(userID + '-refresh2', function (data) {
                    console.log('refresh2');
                });
                //zoom *****
                socket.on(userID + '-zoom', function (data) {
                });

                socket.on(userID + '-find', function (data) {

                });
                exports.socket = socket;
            })(window);

            var theTemplateScript = $("#example-template").html();
            var theTemplate = Handlebars.compile(theTemplateScript);

            $(function () {
                $('.next,.prev').click(function (ev) {
                    boolean = true;
        //        $(this).addClass('test');
                    event.target.id == "nextFoto" ? boolean = true : false;
                    Slide(boolean);
                });
        //    returnData = getNews('http://www.hubanero.it/digitalmenu/backend/public/getmenu/1/1/');
                returnData = getNews('http://www.zetacode.it/upload/getimage.php');

            });

        // limit an array to a maximum of elements (from the start)
            Handlebars.registerHelper('limit', function (arr, limit) {
        // remove this line if you don't want the lodash/underscore dependency
        //  if (!_.isArray(arr)) { return []; }
                return arr.slice(0, limit);
            });

            Handlebars.registerHelper('log', function (sth) {
                console.log(sth)
            });

            Handlebars.registerHelper('eachProperty', function (context, options) {
                var ret = "";
                for (var prop in context) {
                    ret = ret + options.fn({property: prop, value: context[prop]});
                }
                return ret;
            });

        </script>
        <script>
            function slideShow() {
        //    var counter = 0;
                news = $('.news');
                newsCorrente = $('.show');
        //    numSlides = news.length;
        //    newsCorrente = news.eq(counter);
        //    console.log('--'); console.log($numSlides);
                news.hide();
                newsCorrente.addClass('show');
                newsCorrente.css('display', 'inline-block');
        //    $('.notizia:visible').find("[style:'display=inline-block']");
                var next = newsCorrente.next().length ? newsCorrente.next() : newsCorrente.parent().children(':first');
                newsCorrente.hide();
                newsCorrente.removeClass('show');
                next.fadeIn().addClass('show');

                setInterval(function () {
                    Slide(true);
                }, 500 * 1000);
            }
            
            function Slide(nextOrPrev) {
                news = $('.news');
                newsCorrente = $('.show');
                news.hide();
                newsCorrente.addClass('show');
                newsCorrente.css('display', 'inline-block');
                if (nextOrPrev == true) {

                    var next = newsCorrente.next().length ? newsCorrente.next() : newsCorrente.parent().children(':first');
                    $('<div></div>')
                            .attr('id', 'successivo')
                            .css('zIndex', '100')
                            .appendTo('body')
                            .delay('1000')
                            .fadeOut("fast", function () {
                                this.remove()
                            });
                } else {
                    var next = newsCorrente.prev().length ? newsCorrente.prev() : newsCorrente.parent().children(':last');
                    $('<div></div>')
                            .attr('id', 'precedente')
                            .css('zIndex', '100')
                            .appendTo('body')
                            .delay('1000')
                            .fadeOut("fast", function () {
                                this.remove()
                            });
                }

                newsCorrente.hide();
                newsCorrente.removeClass('show');
                next.fadeIn().addClass('show');
            }
            
            
        </script>

    </body>
</html>